<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>X3DOM Documentation: Tutorials</title>    
    <link type="text/css" rel="stylesheet" href="../../../static/styles/x3dom-docs.css">
    <script src="../../../static/scripts/prettify/run_prettify.js"></script>
</head>

<body>

<div id="mainContainerDiv">

<div id="header-decoration">
    official x3<strong>dom</strong> documentation
</div>
<div id="header-navbar">
    <a href="http://x3dom.org">x3dom.org</a>
    &gt;
    <a href="../../../index.html">documentation</a>    
    &gt;
    <a href="../../index.html">Tutorials</a>
	&gt;
    <a href="#">simple AR</a>
</div>
<div id="main">

    <section>	
        
        <div>
            <div class="simpleButton" style="float:left;"><a href="../virtualCatalogue/index.html" style="float:right;">&#8678; Previous Section</a></div>
            <!--div class="simpleButton" style="float:right;"><a href="../../largeModels/culling/index.html" style="float:right;">Next Section &#8680;</a></div-->
            <div style="clear:both;"></div>
        </div>
        <div style="text-align:center;">
            <h1>A simple augmented reality application</h1>
        </div>            
        <br>
		
        <p>
		Augmented reality (AR) is the integration of digital information with live video or the user's environment in real time. 
		In this tutorial you will learn how build a simple AR Application with X3DOM. The goal is to render a 3D-Model on top of a marker filmed by a web-cam. 
		In order to keep it simple we will use the <a href="https://github.com/kig/JSARToolKit">JSARToolKit</a> and to access the webCam we use the navigator.getUserMedia() method. It is only available in HTML 5, so if you are not sure
		if your browser is supporting it properly you can test <a href="http://html5test.com/">here</a>.
        </p>
		<p>
		To get started you need a webcam, <a href="https://github.com/kig/JSARToolKit">the JSARToolKit</a> and X3DOM of course. <br>
		Please create an empty html page, a js file and if you want a css stylesheet. If you have no clue what that means you might want to visit <a href="http://www.w3schools.com/" target="blank"> w3scools</a> or our <a href="../../../index.html" target="blank">earlier tutorials</a>. 
		The index.html file should look similar to the following code and need a  &lt;video&gt; tag to show our video.
		</p>
		<pre class="prettyprint"><code class="language-html">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
   &lt;title&gt;&lt;/title&gt;
   &lt;script src="script.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="video-container"&gt;
      &lt;video id="video" width="500" autoplay&gt;&lt;/video&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
		</code></pre>
		<p>Make sure to not forget to set autoplay in the video tag. In order to keep our code simple we use a prefix to get the usermedia. </p>
		<pre class="prettyprint"><code class="language-js">
// Normalize the various vendor prefixed versions of getUserMedia.
    navigator.getUserMedia = (navigator.getUserMedia ||navigator.webkitGetUserMedia ||
    navigator.mozGetUserMedia ||navigator.msGetUserMedia);
// get the video element
var vid = document.getElementById('video');
 if (navigator.getUserMedia) {
        // Request the camera.
        navigator.getUserMedia(
            { video: true,audio: false},
            // Success Callback
            function(localMediaStream) {
            // Create a url from the stream and use it as source for the video
                vid.src = URL.createObjectURL(localMediaStream);;
            },
            // Error Callback
            function(err) {
                // error occurred
                console.log("there was an wild error");
            });
    } else {
        alert('Seems like your browser has no usermedia support');
    }
        </code></pre>
		<p>
		If you open your index.html from a (local) server you will see your web-stream directly after you granted the access to your cam.
		<br>
		The next step is rendering the video to a canvas and getting the JSARToolkit to work. 
		The Toolkit takes the picture from a canvas and returns a list of the found AR markers and their transformation matrices.
		Later we will take those to transform and position our model on the screen. If you loop this routine you got AR Tracking.
		</p>
		<p>
		To draw the video on a canvas we add a canvas in the html file, a listener in javaScript and hide the video.
		</p>
		<pre class="prettyprint"><code class="language-html">
    &lt;div id="video-container"&gt;
	&ltcanvas id="c" width="320" height="240"&gt;&lt;/canvas&gt;
      &lt;video id="video" width="320" height="240" autoplay hidden&gt;&lt;/video&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
		</code></pre>
		
		 <pre class="prettyprint"><code class="language-js">
//add as global fields 
var c=document.getElementById("c"); //get your canvas
ctx=c.getContext('2d');		//get the context
vid.addEventListener('play',function() {var i=window.setInterval(function() {ctx.drawImage(v,0, 0, 320, 240)},20);},false); //add the listener 

</code></pre>
		<p>
		Be careful with the video and canvas settings if you accidentally stretch the video the tag recognition may not work as intended.<br>
		
		</p>


<pre class="prettyprint"><code class="language-javascript">
	$(document).ready(function(){
		//Every time the user clicks on a catalogue entry
		$(".gallery td").on("click", function() {
			var file = $(this).attr('file');
			
			//Replace the x3d file in the context (if not already loaded)
			if(file != $('#inlineBox').attr('url'))
				$('#inlineBox').attr('url', file);
		});
	});
	
</code></pre>
        
		<p>
		While this implementation uses jQuery to change the url field of the node, this could also be done using plain JavaScript DOM manipulation operations.
		</p>

		<p>
		Your simple catalogue should work now and you can modify and extend it as you want.
		</p>
		
		<div style="text-align:center;">
            <div class="docuFigureContainer">			
                <img class="docuFigure" src='screenshot.png'>
                <div class="docuCaption">Catalogue App Sample</div>
            </div>
        </div> 
        <p>               
        <a href="#">Back to page top &#10548;</a>
        </p>  
        <div class="contentBox">                        
            <h2>Get this X3DOM example:</h2>
            <ul>
                <li><a href="example/index.html"><img src="../../liveDemo.png">Display example HTML file</a></li>                
                <li><a href="javascript:window.location='view-source:' + window.location.href.replace('index.html', 'example/index.html');"><img src="../../source.png">View example page source</a></li>                
                <li><a href="virtualCatalogue.zip"><img src="../../download.png">Download full example (.zip archive)</a></li>
            </ul>      
            <br>
            
            <h2>Read more about the X3DOM nodes used in this tutorial:</h2>
            <ul>
				<li><a href="../../../author/Networking/Inline.html">Inline</a></li>
				
				<li><a href="../../../author/Core/Scene.html">Scene</a></li>
            </ul>
        </div>

    </section>

</div>

</div>

</body>
</html>
